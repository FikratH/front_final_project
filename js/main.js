let dataArr = [
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending1.jpg",
    category: "Men",
    title: "Cashmere Tank + Bag",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending2.jpg",
    title: "Cashmere Tank + Bag",
    category: "Women",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending3.jpg",
    title: "Cashmere Tank + Bag",
    category: "Baby",
    price: "$98.00",
    oldPrice: "$120.00",
  },
  {
    img: "./assets/images/indexPage/trending4.jpg",
    title: "Cashmere Tank + Bag",
    category: "Fashion",
    price: "$98.00",
    oldPrice: "$120.00",
  },
];

let users = [
  {
    id: 1,
    username: "admin",
    email: "admin@gmail.com",
    password: "admin",
    cart: [],
  },
];
let currentUser = "";
let cart = [];
let currentCategory;
const filterBtns = document.querySelectorAll(
  ".main_products_trending_title_categories_category"
);
const slider_wrapper = document.querySelector(
  ".main_products_trending_boxes_wrapper_list"
);
const cart_btn_header = document.querySelector(".header_cart_number");
const sliderItems = document.querySelector(".main_items_boxes_wrapper_list");
const btnToTop = document.querySelector(".button_top");
const usernameField = document.querySelector(".username");

document.addEventListener("DOMContentLoaded", function () {
  if (localStorage.getItem("users")) {
    users = JSON.parse(localStorage.getItem("users"));
  }
  if (localStorage.getItem("currentUser")) {
    currentUser = JSON.parse(localStorage.getItem("currentUser"));
  }
  console.log(currentUser);
  usernameField.innerHTML =
    currentUser.username == null
      ? "No Active User"
      : `Hi, ${currentUser.username}!`;
  console.log("Current user => " + currentUser.username);
  console.log("All users ", users);
  localStorage.setItem("users", JSON.stringify(users));
  slider_wrapper.innerHTML = "";
  sliderItems.innerHTML = "";
  dataArr.forEach((item) => {
    slider_wrapper.innerHTML += `
    <li class="splide__slide" data-category="${item.category.toLowerCase()}" data-id="${dataArr.indexOf(
      item
    )}">
    <div class="main_products_trending_boxes_box">
      <div class="main_products_trending_boxes_box_image">
        <img
          src="${item.img}"
          alt=""
          class="main_products_trending_boxes_box_image_img"
        />
        <div
          class="main_products_trending_boxes_box_image_btns"
        >
          <a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn cart_btn"
          >
            <i class="fa-solid fa-cart-shopping"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-heart"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-magnifying-glass-plus"></i
          ></a>
        </div>
      </div>
      <div class="main_products_trending_boxes_box_desc">
        <a
          href="#"
          class="main_products_trending_boxes_box_desc_title"
          >${item.title} for ${item.category}</a
        >
        <span
          class="main_products_trending_boxes_box_desc_price"
        >
          ${item.price}
          <span
            class="main_products_trending_boxes_box_desc_price_old"
            >${item.oldPrice}</span
          >
        </span>
      </div>
    </div>
  </li>
    `;
    sliderItems.innerHTML += `
    <li class="splide__slide" data-category="${item.category.toLowerCase()}" data-id="${dataArr.indexOf(
      item
    )}">
    <div class="main_products_trending_boxes_box">
      <div class="main_products_trending_boxes_box_image">
        <img
          src="${item.img}"
          alt=""
          class="main_products_trending_boxes_box_image_img"
        />
        <div
          class="main_products_trending_boxes_box_image_btns"
        >
          <a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn cart_btn"
          >
            <i class="fa-solid fa-cart-shopping"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-heart"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-magnifying-glass-plus"></i
          ></a>
        </div>
      </div>
      <div class="main_products_trending_boxes_box_desc">
        <a
          href="#"
          class="main_products_trending_boxes_box_desc_title"
          >${item.title} for ${item.category}</a
        >
        <span
          class="main_products_trending_boxes_box_desc_price"
        >
          ${item.price}
          <span
            class="main_products_trending_boxes_box_desc_price_old"
            >${item.oldPrice}</span
          >
        </span>
      </div>
    </div>
  </li>
    `;
  });

  currentCategory = "men";

  new Splide("#trending", {
    type: "loop",
    perPage: 4,
    perMove: 1,
    pagination: false,
    width: "100%",
    breakpoints: {
      992: {
        perPage: 3,
      },
      778: {
        perPage: 2,
        arrows: false,
      },
    },
  }).mount();

  new Splide("#items", {
    type: "loop",
    perPage: 4,
    perMove: 1,
    pagination: false,
    width: "100%",
    breakpoints: {
      992: {
        perPage: 3,
      },
      778: {
        perPage: 2,
        arrows: false,
      },
    },
  }).mount();

  new Splide("#testimonials", {
    type: "loop",
    perPage: 1,
    perMove: 1,
    pagination: false,
    width: "100%",
  }).mount();
});

filterBtns.forEach((btn) => {
  btn.addEventListener("click", (e) => {
    filterBtns.forEach((btn) => {
      btn.classList.remove("active");
    });
    currentCategory = e.target.dataset.category;
    e.target.classList.add("active");
    filterProducts(currentCategory);
  });
});

function filterProducts(category) {
  const filteredProducts = dataArr.filter((item) => {
    return item.category.toLowerCase() === category;
  });
  console.log(filteredProducts);
  slider_wrapper.innerHTML = "";
  filteredProducts.forEach((item) => {
    slider_wrapper.innerHTML += `
    <li class="splide__slide" data-category="${item.category.toLowerCase()}" data-id="${dataArr.indexOf(
      item
    )}">
    <div class="main_products_trending_boxes_box">
      <div class="main_products_trending_boxes_box_image">
        <img
          src="${item.img}"
          alt=""
          class="main_products_trending_boxes_box_image_img"
        />
        <div
          class="main_products_trending_boxes_box_image_btns"
        >
          <a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn cart_btn"
          >
            <i class="fa-solid fa-cart-shopping"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-heart"></i></a
          ><a
            href="#" onclick="return false" 
            class="main_products_trending_boxes_box_image_btns_btn"
            ><i class="fa-solid fa-magnifying-glass-plus"></i
          ></a>
        </div>
      </div>
      <div class="main_products_trending_boxes_box_desc">
        <a
          href="#"
          class="main_products_trending_boxes_box_desc_title"
          >${item.title} for ${item.category}</a
        >
        <span
          class="main_products_trending_boxes_box_desc_price"
        >
          ${item.price}
          <span
            class="main_products_trending_boxes_box_desc_price_old"
            >${item.oldPrice}</span
          >
        </span>
      </div>
    </div>
  </li>
    `;
  });

  new Splide("#trending", {
    type: "loop",
    perPage: 4,
    perMove: 1,
    breakpoints: {
      992: {
        perPage: 3,
      },
      778: {
        perPage: 2,
        arrows: false,
      },
    },
  }).mount();
}

slider_wrapper.addEventListener("click", (e) => {
  if (
    e.target.classList.contains("cart_btn") ||
    e.target.parentElement.classList.contains("cart_btn")
  ) {
    console.log("cart click");
    const id = e.target.closest("li").dataset.id;
    const product = dataArr[id];
    if (cart.includes(product)) {
      alert("This product is already in your cart");
    } else {
      cart.push(product);
      console.log(cart);
      cart_btn_header.innerHTML = cart.length;
    }
  }
});
sliderItems.addEventListener("click", (e) => {
  if (
    e.target.classList.contains("cart_btn") ||
    e.target.parentElement.classList.contains("cart_btn")
  ) {
    console.log("cart click");
    const id = e.target.closest("li").dataset.id;
    const product = dataArr[id];
    if (cart.includes(product)) {
      alert("This product is already in your cart");
    } else {
      cart.push(product);
      console.log(cart);
      cart_btn_header.innerHTML = cart.length;
    }
  }
});

btnToTop.addEventListener("click", () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth",
  });
});

window.addEventListener("scroll", () => {
  if (window.scrollY > 200) {
    btnToTop.classList.add("active");
  } else {
    btnToTop.classList.remove("active");
  }
});
